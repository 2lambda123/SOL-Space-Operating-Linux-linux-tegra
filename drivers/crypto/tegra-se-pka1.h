/*
 * Driver for Tegra Security Engine
 *
 * Copyright (c) 2016, NVIDIA Corporation. All Rights Reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2, as
 * published by the Free Software Foundation, and may be copied,
 * distributed, and modified under those terms.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 */

#ifndef _CRYPTO_TEGRA_SE_PKA1_H
#define _CRYPTO_TEGRA_SE_PKA1_H

#define TEGRA_SE_PKA1_KEYSLOT_COUNT	4

#define TEGRA_SE_PKA1_FLAGS_OFFSET			0xC024
#define TEGRA_SE_PKA1_FLAGS_FLAG_F0_SHIFT		4
#define TEGRA_SE_PKA1_FLAGS_FLAG_F0(x)	\
				(x << TEGRA_SE_PKA1_FLAGS_FLAG_F0_SHIFT)
#define TEGRA_SE_PKA1_FLAGS_FLAG_F1_SHIFT		5
#define TEGRA_SE_PKA1_FLAGS_FLAG_F1(x)	\
				(x << TEGRA_SE_PKA1_FLAGS_FLAG_F1_SHIFT)
#define TEGRA_SE_PKA1_FLAGS_FLAG_F3_SHIFT		7
#define TEGRA_SE_PKA1_FLAGS_FLAG_F3(x)	\
				(x << TEGRA_SE_PKA1_FLAGS_FLAG_F3_SHIFT)
#define TEGRA_SE_PKA1_FLAGS_FLAG_ZERO_SHIFT		0
#define TEGRA_SE_PKA1_FLAGS_FLAG_ZERO(x)	\
				(x << TEGRA_SE_PKA1_FLAGS_FLAG_ZERO_SHIFT)

#define TEGRA_SE_PKA1_FSTACK_PTR_OFFSET		0xC010

#define PKA1_ENABLE		1
#define PKA1_DISABLE		0
#define TRNG_FALSE		0
#define TRNG_TRUE		1

#define TEGRA_SE_PKA1_INT_ENABLE_OFFSET		0xC040
#define TEGRA_SE_PKA1_INT_ENABLE_IE_IRQ_EN_SHIFT	30
#define TEGRA_SE_PKA1_INT_ENABLE_IE_IRQ_EN(x)	\
			(x << TEGRA_SE_PKA1_INT_ENABLE_IE_IRQ_EN_SHIFT)

#define TEGRA_SE_PKA1_STATUS_OFFSET			0xC020
#define TEGRA_SE_PKA1_STATUS_IRQ_STAT_SHIFT		30
#define TEGRA_SE_PKA1_STATUS_IRQ_STAT(x)	\
			(x << TEGRA_SE_PKA1_STATUS_IRQ_STAT_SHIFT)

#define TEGRA_SE_PKA1_CTRL_STATUS_OFFSET		0x810C
#define TEGRA_SE_PKA1_CTRL_SE_STATUS_SHIFT		0
#define TEGRA_SE_PKA1_CTRL_SE_STATUS_BUSY		1
#define TEGRA_SE_PKA1_CTRL_SE_STATUS_IDLE		0
#define TEGRA_SE_PKA1_CTRL_PKA1_STATUS_SHIFT		1
#define TEGRA_SE_PKA1_CTRL_PKA1_STATUS_BUSY		1
#define TEGRA_SE_PKA1_CTRL_PKA1_STATUS_IDLE		0
#define TEGRA_SE_PKA1_CTRL_PKA1_STATUS(x)	\
				(x << TEGRA_SE_PKA1_CTRL_PKA1_STATUS_SHIFT)
#define TEGRA_SE_PKA1_CTRL_SE_STATUS(x)	\
				(x << TEGRA_SE_PKA1_CTRL_SE_STATUS_SHIFT)

#define TEGRA_SE_PKA1_RETURN_CODE_OFFSET			0xC008
#define TEGRA_SE_PKA1_RETURN_CODE_STOP_REASON_ABNORMAL		0xFF
#define TEGRA_SE_PKA1_RETURN_CODE_STOP_REASON_SHIFT		16
#define TEGRA_SE_PKA1_RETURN_CODE_STOP_REASON(x)	\
			(x << TEGRA_SE_PKA1_RETURN_CODE_STOP_REASON_SHIFT)

#define TEGRA_SE_PKA1_MUTEX_WATCHDOG_OFFSET	0x8110
#define TEGRA_SE_PKA1_MUTEX_OFFSET		0x8114
#define TEGRA_SE_PKA1_MUTEX_RELEASE_OFFSET	0x8118

#define TEGRA_SE_PKA1_MUTEX_TIMEOUT_ACTION_OFFSET	0x8128
#define TEGRA_SE_PKA1_MUTEX_TIMEOUT_ACTION		0x2

#define TEGRA_SE_PKA1_ERROR_CAPTURE_OFFSET	0x8134

#define TEGRA_SE_PKA1_CTRL_OFFSET		0xC000

#define TEGRA_SE_PKA1_CTRL_GO_SHIFT		31
#define TEGRA_SE_PKA1_CTRL_GO_START		1
#define TEGRA_SE_PKA1_CTRL_GO_NOP		0
#define TEGRA_SE_PKA1_CTRL_GO(x)	\
			(x << TEGRA_SE_PKA1_CTRL_GO_SHIFT)

#define TEGRA_SE_PKA1_CTRL_BASE_RADIX_SHIFT	8
#define TEGRA_SE_PKA1_CTRL_BASE_256		2
#define TEGRA_SE_PKA1_CTRL_BASE_512		3
#define TEGRA_SE_PKA1_CTRL_BASE_1024		4
#define TEGRA_SE_PKA1_CTRL_BASE_2048		5
#define TEGRA_SE_PKA1_CTRL_BASE_4096		6
#define TEGRA_SE_PKA1_CTRL_BASE_RADIX(x)	\
				(x << TEGRA_SE_PKA1_CTRL_BASE_RADIX_SHIFT)

#define TEGRA_SE_PKA1_CTRL_PARTIAL_RADIX_SHIFT	0

#define PKA1_OP_SIZE_256		256
#define PKA1_OP_SIZE_512		512
#define PKA1_OP_SIZE_1024	1024
#define PKA1_OP_SIZE_2048	2048
#define PKA1_OP_SIZE_4096	4096

#define TEGRA_SE_PKA1_CTRL_PARTIAL_RADIX(x)	\
				(x << TEGRA_SE_PKA1_CTRL_PARTIAL_RADIX_SHIFT)

#define TEGRA_SE_PKA1_TRNG_SMODE_OFFSET			0xBF0C
#define TEGRA_SE_PKA1_TRNG_SMODE_SECURE_SHIFT		8
#define TEGRA_SE_PKA1_TRNG_SMODE_SECURE(x)	\
				(x << TEGRA_SE_PKA1_TRNG_SMODE_SECURE_SHIFT)

#define TEGRA_SE_PKA1_TRNG_SMODE_NONCE_SHIFT			2
#define TEGRA_SE_PKA1_TRNG_SMODE_NONCE(x)	\
				(x << TEGRA_SE_PKA1_TRNG_SMODE_NONCE_SHIFT)

#define TEGRA_SE_PKA1_CTRL_CONTROL_OFFSET			0x8104
#define TEGRA_SE_PKA1_CTRL_CONTROL_AUTO_RESEED_SHIFT		0
#define TEGRA_SE_PKA1_CTRL_CONTROL_AUTO_RESEED(x)	\
			(x << TEGRA_SE_PKA1_CTRL_CONTROL_AUTO_RESEED_SHIFT)

#define TEGRA_SE_PKA1_CTRL_CONTROL_LOAD_KEY_SHIFT		2
#define TEGRA_SE_PKA1_CTRL_CONTROL_LOAD_KEY(x)	\
			(x << TEGRA_SE_PKA1_CTRL_CONTROL_LOAD_KEY_SHIFT)

#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_SHIFT	16
#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_0		0x00
#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_1		0x01
#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_2		0x02
#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_3		0x03
#define TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT(x)	\
			(x << TEGRA_SE_PKA1_CTRL_CONTROL_KEYSLOT_SHIFT)

#define TEGRA_SE_PKA1_TRNG_STATUS_OFFSET		0xBF04
#define TEGRA_SE_PKA1_TRNG_STATUS_SECURE_SHIFT	8
#define TEGRA_SE_PKA1_TRNG_STATUS_SECURE(x)	\
				(x << TEGRA_SE_PKA1_TRNG_STATUS_SECURE_SHIFT)

#define TEGRA_SE_PKA1_TRNG_STATUS_NONCE_SHIFT	2
#define TEGRA_SE_PKA1_TRNG_STATUS_NONCE(x)	\
				(x << TEGRA_SE_PKA1_TRNG_STATUS_NONCE_SHIFT)

#define TEGRA_SE_PKA1_TRNG_STATUS_SEEDED_SHIFT	9
#define TEGRA_SE_PKA1_TRNG_STATUS_SEEDED(x)	\
				(x << TEGRA_SE_PKA1_TRNG_STATUS_SEEDED_SHIFT)

#define TEGRA_SE_PKA1_TRNG_STATUS_LAST_RESEED_SHIFT		16
#define TRNG_LAST_RESEED_HOST					0
#define TRNG_LAST_RESEED_NONCE					3
#define TRNG_LAST_RESEED_RESEED					4
#define TRNG_LAST_RESEED_UNSEEDED				7
#define TEGRA_SE_PKA1_TRNG_STATUS_LAST_RESEED(x)	\
			(x << TEGRA_SE_PKA1_TRNG_STATUS_LAST_RESEED_SHIFT)

#define TEGRA_SE_PKA1_PRG_ENTRY_OFFSET	0xC004

#define TEGRA_SE_PKA1_RSA_M_PRG_ENTRY_VAL		0x10
#define TEGRA_SE_PKA1_RSA_R2_PRG_ENTRY_VAL		0x12
#define TEGRA_SE_PKA1_RSA_RINV_PRG_ENTRY_VAL		0x11

#define TEGRA_SE_PKA1_RSA_MOD_EXP_PRG_ENTRY_VAL		0x14
#define TEGRA_SE_PKA1_ECC_ECPV_PRG_ENTRY_VAL			0x1E
#define TEGRA_SE_PKA1_ECC_POINT_ADD_PRG_ENTRY_VAL		0x1C
#define TEGRA_SE_PKA1_ECC_POINT_MUL_PRG_ENTRY_VAL		0x19
#define TEGRA_SE_PKA1_ECC_POINT_DOUBLE_PRG_ENTRY_VAL		0x1A
#define TEGRA_SE_PKA1_ECC_SHAMIR_TRICK_PRG_ENTRY_VAL		0x23

#define PKA1_ADDR_OFFSET		0xC000

#define PKA1_BANK_START_A	(PKA1_ADDR_OFFSET + 0x400)
#define PKA1_BANK_START_B	(PKA1_ADDR_OFFSET + 0x800)
#define PKA1_BANK_START_C	(PKA1_ADDR_OFFSET + 0xC00)
#define PKA1_BANK_START_D	(PKA1_ADDR_OFFSET + 0x1000)

#define BANK_A	0
#define BANK_B	1
#define BANK_C	2
#define BANK_D	3

#define TEGRA_SE_PKA1_RSA_MSG_BANK		BANK_A
#define TEGRA_SE_PKA1_RSA_MSG_ID		0
#define TEGRA_SE_PKA1_RSA_EXP_BANK		BANK_D
#define TEGRA_SE_PKA1_RSA_EXP_ID		2
#define TEGRA_SE_PKA1_RSA_RESULT_BANK	BANK_A
#define TEGRA_SE_PKA1_RSA_RESULT_ID		0

#define	TEGRA_SE_PKA1_M_BANK			BANK_D
#define	TEGRA_SE_PKA1_M_ID			1
#define TEGRA_SE_PKA1_RINV_BANK		BANK_C
#define TEGRA_SE_PKA1_RINV_ID		0
#define TEGRA_SE_PKA1_R2_BANK		BANK_D
#define TEGRA_SE_PKA1_R2_ID			3
#define TEGRA_SE_PKA1_MOD_BANK		BANK_D
#define TEGRA_SE_PKA1_MOD_ID			0

#define TEGRA_SE_PKA1_ECC_A_BANK		BANK_A
#define TEGRA_SE_PKA1_ECC_A_ID		6
#define TEGRA_SE_PKA1_ECC_B_BANK		BANK_A
#define TEGRA_SE_PKA1_ECC_B_ID		7
#define TEGRA_SE_PKA1_ECC_N_BANK		0
#define TEGRA_SE_PKA1_ECC_N_ID		0
#define TEGRA_SE_PKA1_ECC_XP_BANK		BANK_A
#define TEGRA_SE_PKA1_ECC_XP_ID		2
#define TEGRA_SE_PKA1_ECC_YP_BANK		BANK_B
#define TEGRA_SE_PKA1_ECC_YP_ID		2
#define TEGRA_SE_PKA1_ECC_XQ_BANK		BANK_A
#define TEGRA_SE_PKA1_ECC_XQ_ID		3
#define TEGRA_SE_PKA1_ECC_YQ_BANK		BANK_B
#define TEGRA_SE_PKA1_ECC_YQ_ID		3
#define TEGRA_SE_PKA1_ECC_K_BANK		BANK_D
#define TEGRA_SE_PKA1_ECC_K_ID		7

#define TEGRA_SE_PKA1_KEYSLOT_ADDR_OFFSET(i)		(0x00008800+((i)*4))
#define TEGRA_SE_PKA1_KEYSLOT_DATA_OFFSET(i)		(0x00008810+((i)*4))

#define TEGRA_SE_PKA1_KEYSLOT_ADDR_AUTO_INC_SHIFT	31
#define TEGRA_SE_PKA1_KEYSLOT_ADDR_AUTO_INC_SET	1
#define TEGRA_SE_PKA1_KEYSLOT_ADDR_AUTO_INC_CLEAR	0
#define TEGRA_SE_PKA1_KEYSLOT_ADDR_AUTO_INC(x)	\
			(x << TEGRA_SE_PKA1_KEYSLOT_ADDR_AUTO_INC_SHIFT)

#define TEGRA_SE_PKA1_KEYSLOT_ADDR_FIELD_SHIFT	8
#define TEGRA_SE_PKA1_KEYSLOT_ADDR_FIELD(x)	\
				(x << TEGRA_SE_PKA1_KEYSLOT_ADDR_FIELD_SHIFT)

#define TEGRA_SE_PKA1_KEYSLOT_ADDR_WORD_SHIFT	0
#define TEGRA_SE_PKA1_KEYSLOT_ADDR_WORD(x)	\
				(x << TEGRA_SE_PKA1_KEYSLOT_ADDR_WORD_SHIFT)

#endif /* _CRYPTO_TEGRA_SE_PKA1_H */
