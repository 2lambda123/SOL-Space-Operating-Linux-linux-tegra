export PGTEST CONFIG_PGTEST_OBJ DWC_ETH_QOS_CONFIG_PGTEST
export DEBUGFS CONFIG_DEBUGFS_OBJ DWC_ETH_QOS_CONFIG_DEBUGFS
export PTPSUPPORT CONFIG_PTPSUPPORT_OBJ DWC_ETH_QOS_CONFIG_PTP

#default values
#DEBUGFS=y	#debugfs is enabled
#PTPSUPPORT=n	#ptp is disabled
#PGTEST=n	#pg(packet generator) is disabled	

ifeq "$(PGTEST)" "y"
CONFIG_PGTEST_OBJ=y
DWC_ETH_QOS_CONFIG_PGTEST=-DPGTEST
EXTRA_CFLAGS+=-DCONFIG_PGTEST_OBJ
else
CONFIG_PGTEST_OBJ=n
endif

ifeq "$(DEBUGFS)" "y"
CONFIG_DEBUGFS_OBJ=y
DWC_ETH_QOS_CONFIG_DEBUGFS=-DDEBUGFS
EXTRA_CFLAGS+=-DCONFIG_DEBUGFS_OBJ
else
CONFIG_DEBUGFS_OBJ=n
endif

ifeq "$(PTPSUPPORT)" "y"
CONFIG_PTPSUPPORT_OBJ=y
DWC_ETH_QOS_CONFIG_PTP=-DPTPSUPPORT
EXTRA_CFLAGS+=-DCONFIG_PTPSUPPORT_OBJ
else
CONFIG_PTPSUPPORT_OBJ=n
endif

obj-m := DWC_ETH_QOS.o

DWC_ETH_QOS-y += DWC_ETH_QOS_dev.o \
			DWC_ETH_QOS_drv.o \
			DWC_ETH_QOS_desc.o \
			DWC_ETH_QOS_ethtool.o \
			DWC_ETH_QOS_pci.o \
			DWC_ETH_QOS_mdio.o \
			DWC_ETH_QOS_eee.o

DWC_ETH_QOS-$(CONFIG_DEBUGFS_OBJ) += DWC_ETH_QOS_debug_operation.o
DWC_ETH_QOS-$(CONFIG_PGTEST_OBJ) += DWC_ETH_QOS_pktgen.o
DWC_ETH_QOS-$(CONFIG_PTPSUPPORT_OBJ) += DWC_ETH_QOS_ptp.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
	gcc -g -DDWC_ETH_QOS_CONFIG_PGTEST -DDWC_ETH_QOS_CONFIG_DEBUGFS -DDWC_ETH_QOS_CONFIG_PTP DWC_ETH_QOS_api.c -o DWC_ETH_QOS_api && mv DWC_ETH_QOS_api $(DWC_ETH_QOS_COMP_DRV_DEBUG_SCRIPTS)

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
	rm -f $(DWC_ETH_QOS_COMP_DRV_DEBUG_SCRIPTS)/DWC_ETH_QOS_api

